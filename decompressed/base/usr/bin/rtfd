#!/bin/sh

# tch-nginx-gui policy: wrap stock rtfd

check_full_rootfs() {
  rootfx_percet=$(df /overlay | sed -n 2p | awk {'{print $5}'} | sed 's|%||')
  overlay_mtdblock=$(df /overlay | sed -n 2p | awk {'{print $1}'})
  bootedbank=$(cat /proc/banktable/booted)
  #Reset if rootfs more than 97% full
  if [ "$rootfx_percet" -gt 96 ]; then
    mtd -r erase "$overlay_mtdblock"
    return 1
  fi
  return 0
}

check_full_rootfs || exit 1

#prepare_root_runonce $(cat /proc/banktable/booted)

. /rom/usr/bin/rtfd